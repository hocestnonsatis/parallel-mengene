#!/usr/bin/env bash
set -euo pipefail

if ! command -v cargo >/dev/null 2>&1; then
  echo 'cargo not found in PATH' >&2
  exit 1
fi

cargo fmt --all

if ! git diff --quiet; then
  echo 'Formatting changes detected. Staging and committing...' >&2
  git add -A
  git commit -m "chore(fmt): apply cargo fmt before push"
  echo 'Please re-run git push.' >&2
  exit 1
fi

exit 0